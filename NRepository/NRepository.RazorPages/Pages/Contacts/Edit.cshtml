@page
@model NRepository.RazorPages.Pages.Contacts.EditModel

@{
    ViewData["Title"] = "Edit";
}

<h2>Edit</h2>

<h4>Contact</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form method="post">
            @*<div asp-validation-summary="ModelOnly" class="text-danger" id=""></div>*@
            @Html.ValidationSummary(false, "", new { @class = "text-danger", @id = "validationSummary" })
            <h1>Contact Details</h1>
            <input type="hidden" asp-for="ViewModel.GUID" />
            <input type="hidden" asp-for="ViewModel.OriginalVMObject" />
            
            <div class="form-group">
                <label asp-for="ViewModel.FirstName" class="control-label"></label>
                <input asp-for="ViewModel.FirstName" class="form-control" />
                <span asp-validation-for="ViewModel.FirstName" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="ViewModel.LastName" class="control-label"></label>
                <input asp-for="ViewModel.LastName" class="form-control" />
                <span asp-validation-for="ViewModel.LastName" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="ViewModel.MiddleName" class="control-label"></label>
                <input asp-for="ViewModel.MiddleName" class="form-control" />
                <span asp-validation-for="ViewModel.MiddleName" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="ViewModel.Title" class="control-label"></label>
                <input asp-for="ViewModel.Title" class="form-control" />
                <span asp-validation-for="ViewModel.Title" class="text-danger"></span>
            </div>
            @*<div class="form-group">
            <label asp-for="ViewModel.Credentials" class="control-label"></label>
            <input asp-for="ViewModel.Credentials" class="form-control" />
            <span asp-validation-for="ViewModel.Credentials" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ViewModel.Prefix" class="control-label"></label>
            <input asp-for="ViewModel.Prefix" class="form-control" />
            <span asp-validation-for="ViewModel.Prefix" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ViewModel.Suffix" class="control-label"></label>
            <input asp-for="ViewModel.Suffix" class="form-control" />
            <span asp-validation-for="ViewModel.Suffix" class="text-danger"></span>
        </div>*@
            <div class="form-group">
                <label asp-for="ViewModel.CompanyName" class="control-label"></label>
                <input asp-for="ViewModel.CompanyName" class="form-control" />
                <span asp-validation-for="ViewModel.CompanyName" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="ViewModel.TypeID" class="control-label"></label>
                <select asp-for="ViewModel.TypeID" class="form-control" asp-items="ViewBag.TypeID"></select>
                <span asp-validation-for="ViewModel.TypeID" class="text-danger"></span>
            </div>
            <div class="form-group">
                <div class="checkbox">
                    <label>
                        <input asp-for="ViewModel.IsMd" /> @Html.DisplayNameFor(model => model.ViewModel.IsMd)
                    </label>
                </div>
            </div>
            @*<div class="form-group">
            <label asp-for="ViewModel.Version" class="control-label"></label>
            <input asp-for="ViewModel.Version" class="form-control" />
            <span asp-validation-for="ViewModel.Version" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ViewModel.CreatedDate" class="control-label"></label>
            <input asp-for="ViewModel.CreatedDate" class="form-control" />
            <span asp-validation-for="ViewModel.CreatedDate" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ViewModel.CreatedBy" class="control-label"></label>
            <input asp-for="ViewModel.CreatedBy" class="form-control" />
            <span asp-validation-for="ViewModel.CreatedBy" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ViewModel.ModifiedDate" class="control-label"></label>
            <input asp-for="ViewModel.ModifiedDate" class="form-control" />
            <span asp-validation-for="ViewModel.ModifiedDate" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ViewModel.ModifiedBy" class="control-label"></label>
            <input asp-for="ViewModel.ModifiedBy" class="form-control" />
            <span asp-validation-for="ViewModel.ModifiedBy" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ViewModel.SSN" class="control-label"></label>
            <input asp-for="ViewModel.SSN" class="form-control" />
            <span asp-validation-for="ViewModel.SSN" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ViewModel.IsTest" class="control-label"></label>
            <input asp-for="ViewModel.IsTest" class="form-control" />
            <span asp-validation-for="ViewModel.IsTest" class="text-danger"></span>
        </div>
        <div class="form-group">
            <div class="checkbox">
                <label>
                    <input asp-for="ViewModel.IsDemo" /> @Html.DisplayNameFor(model => model.ViewModel.IsDemo)
                </label>
            </div>
        </div>*@
            <div class="form-group">
                <div class="checkbox">
                    <label>
                        <input asp-for="ViewModel.IsDeleted" /> @Html.DisplayNameFor(model => model.ViewModel.IsDeleted)
                    </label>
                </div>
            </div>
            @*<div class="form-group">
            <label asp-for="ViewModel.Department" class="control-label"></label>
            <input asp-for="ViewModel.Department" class="form-control" />
            <span asp-validation-for="ViewModel.Department" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ViewModel.CreatedByUserID" class="control-label"></label>
            <input asp-for="ViewModel.CreatedByUserID" class="form-control" />
            <span asp-validation-for="ViewModel.CreatedByUserID" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="ViewModel.ModifiedByUserID" class="control-label"></label>
            <input asp-for="ViewModel.ModifiedByUserID" class="form-control" />
            <span asp-validation-for="ViewModel.ModifiedByUserID" class="text-danger"></span>
        </div>*@




            <H3 style="display: inline-block"> Emails</H3>
            <button class="btn btn-xs btn-success" onclick="addContactRow('#listOfContactEmail', 'templateEmailRow', 'DummyContact_ContactEmails', 'Contact_ContactEmails')">
                <span class="glyphicon glyphicon-plus-sign"></span>
            </button>
            <hr />
            <div class="form-horizontal" style="width:400px;" id="listOfContactEmail">
                @Html.EditorFor(model => Model.ViewModel.ContactEmails, "ContactEmailEdit")
            </div>



            <H3 style="display: inline-block"> Addresses</H3>
            <button class="btn btn-xs btn-success" onclick="addContactRow('#listOfContactAddresses', 'templateAddressRow', 'DummyContact_ContactAddresses', 'Contact_ContactAddresses')">
                <span class="glyphicon glyphicon-plus-sign"></span>
            </button>
            <hr />
            <div class="form-horizontal" style="width:400px;" id="listOfContactAddresses">
                @Html.EditorFor(model => Model.ViewModel.ContactAddresses, "ContactAddressEdit")
            </div>




            <H3 style="display: inline-block"> Phones</H3>
            <button class="btn btn-xs btn-success" onclick="addContactRow('#listOfContactPhones', 'templatePhonesRow', 'DummyContact_ContactPhones', 'Contact_ContactPhones')">
                <span class="glyphicon glyphicon-plus-sign"></span>
            </button>
            <hr />
            <div class="form-horizontal" style="width:400px;" id="listOfContactPhones">
                @Html.EditorFor(model => Model.ViewModel.ContactPhones, "ContactPhoneEdit")

            </div>
            <div class="form-group">
                <input type="submit" value="Save" class="btn btn-default" />
            </div>
        </form>


    </div>
</div>

<div>
    <a asp-page="./Index">Back to List</a>
</div>
@*<div>
        <a id="linkAddTermsRow" onclick="addContactEmailsRow();">add ContactEmails</a>
    </div>*@
<p>The client side new items templates are here - start</p>
<partial name="ClientTemplates/_DummyItems" />
<p>The client side new items templates are here - end </p>

@*<script id="templateEmailRow" type="text/template">
    @Html.EditorFor(model => Model.DummyViewModel.ContactEmails, "ContactEmailEdit")
</script>

<script id="templateAddressRow" type="text/template">
    @Html.EditorFor(model => Model.DummyViewModel.ContactAddresses, "ContactAddressEdit")
</script>

<script id="templatePhonesRow" type="text/template">
    @Html.EditorFor(model => Model.DummyViewModel.ContactPhones, "ContactPhoneEdit")
</script>*@

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="~/js/lodash.js"></script>
    <script src="~/js/ServerValidationOnSubmit.js"></script>
}


<script>

// Example output -  <input id="Contact_ContactEmails_5__Name" name="ViewModel.ContactEmails[5].Name"  >
    function addContactRow(parentKey,TemplateRowKey, dummyIdKey, idKey) {
        event.preventDefault();
        alert('bob15');
         
        var nameKeyPattern = new RegExp("_", "g");
        var dummyNameKey = dummyIdKey.replace(nameKeyPattern, ".");
        var nameKey = idKey.replace(nameKeyPattern, ".");

        var msg1 = 'The dummy name key is ' + dummyNameKey;
        var msg2 = 'The name key is ' + nameKey;
        console.log(msg1);
        console.log(msg2);

        
        // find the length of the current list so we can give the next element the correct sequence number
        var nextSequenceNumber = $(parentKey).children('div').length;
       // alert(index);
        //var idnewValue = 'Contact_ContactEmails' + '_' + index; //id="Contact_ContactEmails_5__Name"
        //var nameNewValue = 'ViewModel.ContactEmails' + '[' + index + ']'; //name="ViewModel.ContactEmails[5].Name"
 
        //var idPattern = new RegExp("DummyContact_ContactEmails" + '_0', "g"); //'DummyContact_ContactEmails_0'
        //var namePattern = new RegExp("DummyViewModel.ContactEmails" + "\\[0\\]", "g"); //'DummyViewModel.ContactEmails[0]'

        var idnewValue = idKey + '_' + nextSequenceNumber; //id="Contact_ContactEmails_5__Name"
        var nameNewValue = nameKey + '[' + nextSequenceNumber + ']'; //name="ViewModel.ContactEmails[5].Name"

        var idPattern = new RegExp(dummyIdKey + '_0', "g"); //'DummyContact_ContactEmails_0'
        var namePattern = new RegExp(dummyNameKey + "\\[0\\]", "g"); //'DummyViewModel.ContactEmails[0]'

        // find the template Row
        var templateRow = $('#' + TemplateRowKey).html();//'#templateEmailRow'

        // swap the name and the ID values of the template row
        templateRow = templateRow.replace(idPattern, idnewValue);
        templateRow = templateRow.replace(namePattern, nameNewValue);

        
    // find the parent item so we can append the new template
        var table = $(parentKey);
    // var table = $('#TermsTable tbody');

        table.append(templateRow)

       // nextRowIndex++;


        //http://stackoverflow.com/questions/28019793/submit-same-partial-view-called-multiple-times-data-to-controller/28081308#28081308
        $('form').data('validator', null);
        $.validator.unobtrusive.parse($('form'));

        // hiddenTermsCountControl.val(nextRowIndex);
    }

</script>
